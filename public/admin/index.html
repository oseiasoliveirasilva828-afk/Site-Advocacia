<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciar Site - Edson Maltez</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <!-- Carregar React e ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Carregar marked para processar markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <script>
    // Função para extrair ID do YouTube
    function extractYouTubeId(url) {
      if (!url) return null;
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }

    // Componente de pré-visualização
    const PostPreview = ({ entry }) => {
      // Pegar dados do entry
      const title = entry.getIn(['data', 'title']) || 'Sem título';
      const date = entry.getIn(['data', 'date']) || new Date().toISOString();
      const category = entry.getIn(['data', 'category']);
      const description = entry.getIn(['data', 'description']);
      const image = entry.getIn(['data', 'image']);
      const featuredVideo = entry.getIn(['data', 'featured_video']);
      const author = entry.getIn(['data', 'author']) || 'Edson Silva Maltez';
      const body = entry.getIn(['data', 'body']) || '';

      // Processar vídeo
      let videoContent = null;
      if (featuredVideo) {
        const videoData = featuredVideo.toJSON ? featuredVideo.toJSON() : featuredVideo;
        
        if (videoData.type === 'youtube' && videoData.url) {
          const videoId = extractYouTubeId(videoData.url);
          if (videoId) {
            videoContent = React.createElement('div', { className: 'video-preview' },
              React.createElement('iframe', {
                src: `https://www.youtube.com/embed/${videoId}`,
                allowFullScreen: true
              }),
              videoData.caption ? React.createElement('div', { className: 'video-caption' }, videoData.caption) : null
            );
          }
        } else if (videoData.type === 'upload' && videoData.file) {
          videoContent = React.createElement('div', { className: 'video-preview' },
            React.createElement('video', { controls: true },
              React.createElement('source', { src: videoData.file, type: 'video/mp4' })
            ),
            videoData.caption ? React.createElement('div', { className: 'video-caption' }, videoData.caption) : null
          );
        }
      }

      // Processar imagem
      const imageContent = !featuredVideo && image ? 
        React.createElement('img', { src: image, className: 'preview-image' }) : null;

      // Processar markdown
      const contentHtml = window.marked ? window.marked.parse(body) : body;

      // Formatar data
      const formattedDate = new Date(date).toLocaleDateString('pt-BR');

      // Montar componente
      return React.createElement('div', { className: 'preview-container' },
        // Header
        React.createElement('div', { className: 'preview-header' },
          category ? React.createElement('span', { className: 'preview-category' }, category) : null,
          React.createElement('h1', { className: 'preview-title' }, title),
          description ? React.createElement('p', { className: 'preview-description' }, description) : null,
          React.createElement('div', { className: 'preview-meta' },
            React.createElement('span', null, `📅 ${formattedDate}`),
            React.createElement('span', null, `⚖️ ${author}`)
          )
        ),
        
        // Vídeo ou imagem
        videoContent,
        imageContent,
        
        // Conteúdo
        React.createElement('div', { 
          className: 'preview-content',
          dangerouslySetInnerHTML: { __html: contentHtml }
        }),
        
        // Footer
        React.createElement('div', { className: 'preview-footer' },
          `Publicado por ${author} • OAB/SP 344.956`
        )
      );
    };

    // Registrar o componente
    CMS.registerPreviewTemplate('posts', PostPreview);

    // Registrar estilos
    CMS.registerPreviewStyle(`
      .preview-container {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .preview-header {
        background: linear-gradient(135deg, #0a2472 0%, #1e3a8a 100%);
        color: white;
        padding: 40px;
        text-align: center;
        margin-bottom: 30px;
        border-radius: 8px;
      }
      .preview-category {
        background: #c9a227;
        color: #0a2472;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 15px;
      }
      .preview-title {
        font-size: 36px;
        margin: 10px 0;
      }
      .preview-description {
        font-size: 18px;
        opacity: 0.9;
        max-width: 600px;
        margin: 15px auto;
      }
      .preview-meta {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        font-size: 14px;
        opacity: 0.8;
      }
      .video-preview {
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      .video-preview iframe {
        width: 100%;
        height: 315px;
        border-radius: 8px;
        border: none;
      }
      .video-preview video {
        width: 100%;
        max-height: 400px;
        border-radius: 8px;
      }
      .video-caption {
        text-align: center;
        margin-top: 10px;
        color: #666;
        font-style: italic;
      }
      .preview-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 30px;
      }
      .preview-content {
        font-size: 16px;
        line-height: 1.8;
        color: #333;
      }
      .preview-content h1 { font-size: 32px; margin: 20px 0 10px; color: #0a2472; }
      .preview-content h2 { font-size: 28px; margin: 18px 0 8px; color: #1e3a8a; }
      .preview-content h3 { font-size: 24px; margin: 16px 0 6px; }
      .preview-content p { margin: 15px 0; }
      .preview-content blockquote {
        border-left: 4px solid #c9a227;
        padding-left: 20px;
        margin: 20px 0;
        font-style: italic;
        color: #555;
        background: #f9f9f9;
        padding: 15px 20px;
        border-radius: 0 8px 8px 0;
      }
      .preview-content ul, .preview-content ol { margin: 15px 0; padding-left: 30px; }
      .preview-content li { margin: 5px 0; }
      .preview-content a { color: #c9a227; text-decoration: none; }
      .preview-content a:hover { text-decoration: underline; }
      .preview-content img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 20px 0;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      .preview-footer {
        margin-top: 50px;
        padding-top: 20px;
        border-top: 2px solid #c9a227;
        text-align: center;
        font-size: 14px;
        color: #666;
      }
    `);

    console.log('Pré-visualização React carregada!');
  </script>
</body>
</html>